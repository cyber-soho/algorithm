<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 02: Traffic Sorter & Priority Queue</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f5f5f0; color: #333; }
        .chart-container { position: relative; width: 100%; max-width: 100%; height: 350px; }
        .card { background-color: white; border-radius: 0.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn { transition: all 0.2s; }
        .btn:active { transform: scale(0.98); }
        /* Custom scrollbar for alert list */
        .alert-scroll::-webkit-scrollbar { width: 8px; }
        .alert-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .alert-scroll::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
        .alert-scroll::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
    </style>
    <!-- Chosen Palette: Warm Neutrals & Professional Slate -->
    <!-- Application Structure Plan: 
         1. Introduction/Dashboard: High-level context of the Network Infrastructure Suite and the specific module goals.
         2. Adaptive Sorting Engine (Exercise A): Interactive simulation where users define dataset characteristics (disorder, size) to see the logic of the adaptive engine (which algo is chosen and why).
         3. Priority Queue System (Exercise B): A functional simulation of the alert system. Users can inject alerts and simulate time passing to observe priority shifts and anti-starvation logic.
         4. Performance Analysis (Exercise C): Interactive charts comparing the theoretical and practical performance of the algorithms, allowing users to verify their findings.
         This structure moves from Context -> Logic/Mechanism -> Operations -> Analysis, mirroring the learning lifecycle.
    -->
    <!-- Visualization & Content Choices:
         - Charts: Chart.js used for complexity analysis (Line charts for O(N) vs O(N log N)).
         - Icons: Unicode characters used for alert severity and algorithm types (No SVG).
         - Layout: Grid-based dashboard for the Priority Queue to show "Incoming" vs "Processed" states.
         - Interactions: Sliders for "Disorder" to visualize adaptive logic; Buttons to "Tick Tock" time for priority queue simulation.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-[#F5F5F0] text-slate-800 antialiased min-h-screen flex flex-col">

    <!-- Navigation -->
    <nav class="bg-slate-900 text-[#F5F5F0] sticky top-0 z-50 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center space-x-2">
                    <span class="text-2xl">‚ö°</span>
                    <span class="font-bold text-lg tracking-wide">NetAdmin Suite: Module 02</span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <button onclick="navigate('intro')" class="nav-btn px-3 py-2 rounded-md text-sm font-medium hover:bg-slate-700 transition">Overview</button>
                        <button onclick="navigate('sorting')" class="nav-btn px-3 py-2 rounded-md text-sm font-medium hover:bg-slate-700 transition">Adaptive Sorter</button>
                        <button onclick="navigate('queue')" class="nav-btn px-3 py-2 rounded-md text-sm font-medium hover:bg-slate-700 transition">Priority Queue</button>
                        <button onclick="navigate('analysis')" class="nav-btn px-3 py-2 rounded-md text-sm font-medium hover:bg-slate-700 transition">Analysis Report</button>
                    </div>
                </div>
                <!-- Mobile menu button placeholder -->
                <div class="-mr-2 flex md:hidden">
                    <button onclick="toggleMobileMenu()" class="bg-slate-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-slate-700 focus:outline-none">
                        <span class="text-xl">‚ò∞</span>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-slate-800">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <button onclick="navigate('intro')" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-slate-700 w-full text-left">Overview</button>
                <button onclick="navigate('sorting')" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-slate-700 w-full text-left">Adaptive Sorter</button>
                <button onclick="navigate('queue')" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-slate-700 w-full text-left">Priority Queue</button>
                <button onclick="navigate('analysis')" class="block px-3 py-2 rounded-md text-base font-medium text-white hover:bg-slate-700 w-full text-left">Analysis Report</button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">

        <!-- SECTION 1: INTRODUCTION -->
        <section id="intro" class="section-content space-y-8 animate-fade-in">
            <div class="bg-white rounded-xl shadow-sm p-8 border-l-4 border-slate-600">
                <h1 class="text-3xl font-bold text-slate-900 mb-4">Traffic Sorter Module</h1>
                <p class="text-lg text-slate-600 leading-relaxed mb-6">
                    Welcome to the <strong>Network Infrastructure Automation Suite</strong>. In Module 02, we focus on managing the deluge of data generated by modern network infrastructure. 
                    Routers and switches produce millions of log entries that arrive in unpredictable orders. To detect anomalies and manage alerts effectively, we need robust, intelligent algorithms.
                </p>
                <div class="grid md:grid-cols-3 gap-6 mt-8">
                    <div class="bg-slate-50 p-6 rounded-lg border border-slate-200">
                        <div class="text-3xl mb-3">üå™Ô∏è</div>
                        <h3 class="font-bold text-slate-800 mb-2">Adaptive Sorting</h3>
                        <p class="text-sm text-slate-600">
                            Network logs are often "nearly sorted." We need an engine that detects this order to optimize performance, switching between InsertionSort, MergeSort, and QuickSort.
                        </p>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-lg border border-slate-200">
                        <div class="text-3xl mb-3">üö®</div>
                        <h3 class="font-bold text-slate-800 mb-2">Priority Alerts</h3>
                        <p class="text-sm text-slate-600">
                            Not all alerts are equal. A brute-force attack (Severity 0) must preempt a routine ping failure (Severity 6). We implement a Min-Heap Priority Queue to manage this triage.
                        </p>
                    </div>
                    <div class="bg-slate-50 p-6 rounded-lg border border-slate-200">
                        <div class="text-3xl mb-3">üìä</div>
                        <h3 class="font-bold text-slate-800 mb-2">Performance Analysis</h3>
                        <p class="text-sm text-slate-600">
                            Theory meets practice. We benchmark our algorithms to understand the real-world impact of O(n) vs O(n log n) on large datasets.
                        </p>
                    </div>
                </div>
            </div>

            <div class="bg-amber-50 rounded-xl p-6 border border-amber-200">
                <h3 class="font-bold text-amber-800 flex items-center gap-2">
                    <span>‚ö†Ô∏è</span> Important Ethical Notice
                </h3>
                <p class="text-sm text-amber-800 mt-2">
                    The techniques used here resemble real-world cybersecurity operations. All analysis must be performed in your own controlled lab environment. 
                    Unauthorized monitoring of networks you do not own is a violation of institutional policy and potentially federal law (e.g., <em>Criminal Code of Canada</em>).
                </p>
            </div>
        </section>

        <!-- SECTION 2: ADAPTIVE SORTER -->
        <section id="sorting" class="section-content hidden space-y-8">
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-2xl font-bold text-slate-900 mb-2">Exercise A: Adaptive Sorting Engine</h2>
                <p class="text-slate-600 mb-6">
                    This engine analyzes incoming log batches to detect their "Disorder Ratio." Based on this metric, it selects the most efficient algorithm.
                    Interact with the simulator below to understand the decision logic.
                </p>

                <div class="grid lg:grid-cols-12 gap-8">
                    <!-- Control Panel -->
                    <div class="lg:col-span-4 space-y-6 bg-slate-50 p-6 rounded-lg border border-slate-200 h-fit">
                        <h3 class="font-semibold text-lg text-slate-800 border-b pb-2">Input Simulation</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Dataset Size (N)</label>
                            <input type="range" id="datasetSize" min="1000" max="100000" step="1000" value="10000" class="w-full accent-indigo-600">
                            <div class="flex justify-between text-xs text-slate-500 mt-1">
                                <span>1k</span>
                                <span id="sizeValue" class="font-bold text-indigo-600">10,000</span>
                                <span>100k</span>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-1">Disorder Ratio (%)</label>
                            <input type="range" id="disorderRatio" min="0" max="100" step="1" value="2" class="w-full accent-rose-600">
                            <div class="flex justify-between text-xs text-slate-500 mt-1">
                                <span>Sorted (0%)</span>
                                <span id="disorderValue" class="font-bold text-rose-600">2%</span>
                                <span>Random (100%)</span>
                            </div>
                            <p class="text-xs text-slate-500 mt-2 italic">
                                *Inversion Count approximation. <br>Low = "Nearly Sorted", High = "Randomized".
                            </p>
                        </div>

                        <div class="pt-4 border-t border-slate-200">
                            <h4 class="text-sm font-semibold text-slate-700 mb-2">Detected State:</h4>
                            <div id="stateBadge" class="inline-block px-3 py-1 rounded-full text-sm font-bold bg-green-100 text-green-800">
                                Nearly Sorted
                            </div>
                        </div>
                    </div>

                    <!-- Visualization Panel -->
                    <div class="lg:col-span-8 space-y-6">
                        <!-- Decision Flow -->
                        <div class="bg-white border-2 border-slate-100 rounded-lg p-6 relative overflow-hidden">
                            <div class="absolute top-0 right-0 p-4 opacity-10 text-9xl">‚öôÔ∏è</div>
                            <h3 class="font-bold text-xl text-slate-800 mb-4">Engine Logic</h3>
                            
                            <div class="grid grid-cols-3 gap-4 text-center">
                                <div id="card-insertion" class="algo-card p-4 rounded-lg border-2 border-indigo-500 bg-indigo-50 transition-all opacity-100 transform scale-105 shadow-md">
                                    <div class="text-2xl mb-2">üì•</div>
                                    <h4 class="font-bold text-indigo-900">InsertionSort</h4>
                                    <p class="text-xs text-indigo-700 mt-1">Best for low disorder</p>
                                    <div class="mt-2 text-xs font-mono bg-white bg-opacity-50 rounded px-1">O(N) Best Case</div>
                                </div>
                                <div id="card-merge" class="algo-card p-4 rounded-lg border border-slate-200 opacity-50">
                                    <div class="text-2xl mb-2">üîó</div>
                                    <h4 class="font-bold text-slate-700">MergeSort</h4>
                                    <p class="text-xs text-slate-500 mt-1">Stable & Consistent</p>
                                    <div class="mt-2 text-xs font-mono bg-slate-100 rounded px-1">O(N log N)</div>
                                </div>
                                <div id="card-quick" class="algo-card p-4 rounded-lg border border-slate-200 opacity-50">
                                    <div class="text-2xl mb-2">‚ö°</div>
                                    <h4 class="font-bold text-slate-700">QuickSort</h4>
                                    <p class="text-xs text-slate-500 mt-1">Fastest Average</p>
                                    <div class="mt-2 text-xs font-mono bg-slate-100 rounded px-1">O(N log N)</div>
                                </div>
                            </div>

                            <div class="mt-6 bg-slate-900 text-slate-200 p-4 rounded font-mono text-sm overflow-x-auto">
                                <p class="text-gray-400">// Adaptive Selection Logic</p>
                                <p>function <span class="text-yellow-400">adaptiveSort</span>(logs) {</p>
                                <p class="pl-4">disorder = <span class="text-blue-400">measureDisorder</span>(logs); <span class="text-green-500" id="code-disorder-val">// 2%</span></p>
                                <p class="pl-4 text-purple-400" id="code-logic">if (disorder < 5%) return insertionSort(logs);</p>
                                <p>}</p>
                            </div>
                        </div>

                        <!-- Theoretical Performance Chart -->
                        <div class="bg-white rounded-lg border border-slate-200 p-4">
                            <h4 class="font-semibold text-slate-800 mb-2">Theoretical Operations Count</h4>
                            <div class="chart-container h-64">
                                <canvas id="algoChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: PRIORITY QUEUE -->
        <section id="queue" class="section-content hidden space-y-8">
            <div class="bg-white rounded-xl shadow-sm p-6">
                <div class="flex justify-between items-start mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-900 mb-2">Exercise B: Alert Priority Queue</h2>
                        <p class="text-slate-600 max-w-2xl">
                            Simulating a <strong>Binary Min-Heap</strong>. Alerts are processed based on <code>Effective Priority = Base Severity - (Age * Penalty)</code>.
                            Watch how low-severity alerts eventually bubble up to prevent starvation.
                        </p>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-slate-500">Simulation Time</div>
                        <div id="simClock" class="text-2xl font-mono font-bold text-slate-800">00:00</div>
                    </div>
                </div>

                <div class="grid lg:grid-cols-3 gap-8">
                    <!-- Input Column -->
                    <div class="space-y-6">
                        <div class="bg-slate-50 p-5 rounded-lg border border-slate-200 shadow-sm">
                            <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                                <span>üîî</span> Generate Alert
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Severity (0=Critical)</label>
                                    <select id="alertSeverity" class="w-full border-slate-300 rounded-md shadow-sm p-2 text-sm">
                                        <option value="0">0 - Emergency (System Down)</option>
                                        <option value="1">1 - Alert (Immediate Action)</option>
                                        <option value="2">2 - Critical</option>
                                        <option value="3">3 - Error</option>
                                        <option value="4">4 - Warning</option>
                                        <option value="5" selected>5 - Notice (Normal)</option>
                                        <option value="6">6 - Info</option>
                                        <option value="7">7 - Debug</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-bold text-slate-500 uppercase tracking-wide mb-1">Description</label>
                                    <input type="text" id="alertDesc" value="Port 80 Latency High" class="w-full border-slate-300 rounded-md shadow-sm p-2 text-sm">
                                </div>
                                <button onclick="addAlert()" class="btn w-full bg-slate-800 text-white py-2 rounded shadow hover:bg-slate-700 font-medium">
                                    Inject Alert
                                </button>
                            </div>
                        </div>

                        <div class="bg-amber-50 p-5 rounded-lg border border-amber-200">
                            <h3 class="font-bold text-amber-900 mb-2 text-sm">Controls</h3>
                            <button onclick="advanceTime()" class="btn w-full bg-white border border-amber-300 text-amber-900 py-2 rounded shadow-sm hover:bg-amber-100 font-medium mb-2 flex justify-center items-center gap-2">
                                <span>‚è±Ô∏è</span> Advance Time (+15m)
                            </button>
                            <p class="text-xs text-amber-800 text-center">
                                Simulates aging. Look for Priority updates!
                            </p>
                            <button onclick="processAlert()" class="btn w-full mt-4 bg-green-600 text-white py-2 rounded shadow hover:bg-green-500 font-medium flex justify-center items-center gap-2">
                                <span>‚úÖ</span> Process Top Alert
                            </button>
                        </div>
                    </div>

                    <!-- Queue Visualizer -->
                    <div class="lg:col-span-2 bg-slate-100 rounded-lg p-1 border border-slate-200 h-[500px] flex flex-col">
                        <div class="grid grid-cols-12 bg-white p-3 border-b border-slate-200 text-xs font-bold text-slate-500 uppercase tracking-wider">
                            <div class="col-span-2">ID</div>
                            <div class="col-span-2">Base Sev</div>
                            <div class="col-span-2 text-indigo-600">Eff. Prio</div>
                            <div class="col-span-2">Age (m)</div>
                            <div class="col-span-4">Description</div>
                        </div>
                        <div id="alertList" class="alert-scroll flex-grow overflow-y-auto p-2 space-y-2">
                            <!-- Alerts injected here via JS -->
                            <div class="text-center text-slate-400 mt-20 italic">Queue is empty. Systems nominal.</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 4: ANALYSIS REPORT -->
        <section id="analysis" class="section-content hidden space-y-8">
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-2xl font-bold text-slate-900 mb-6">Exercise C: Performance Comparison Report</h2>
                
                <div class="grid lg:grid-cols-2 gap-8 mb-8">
                    <!-- Textual Analysis -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-bold text-slate-800 border-b pb-2">Key Findings</h3>
                        <ul class="space-y-3 text-slate-600 text-sm">
                            <li class="flex items-start gap-2">
                                <span class="text-green-500 font-bold">‚úì</span>
                                <span><strong>Adaptive Advantage:</strong> On nearly-sorted logs (Disorder < 5%), InsertionSort outperformed QuickSort by approx 400% due to O(N) efficiency.</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-blue-500 font-bold">‚úì</span>
                                <span><strong>Stability Matters:</strong> MergeSort was retained for medium disorder to preserve chronological stability of logs with equal timestamps.</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="text-rose-500 font-bold">‚úì</span>
                                <span><strong>Starvation Prevention:</strong> Without the age penalty mechanism, Severity 6/7 alerts had wait times > 4 hours during stress testing. With the penalty, max wait was capped at 45 mins.</span>
                            </li>
                        </ul>
                        
                        <div class="bg-slate-50 p-4 rounded mt-4 text-xs font-mono text-slate-700 border border-slate-200">
                            <strong>Recommendation:</strong><br>
                            For the production ISP environment, deploy the Adaptive Engine with thresholds set at 5% and 40%. Use HeapSort on embedded edge routers where memory is < 512MB.
                        </div>
                    </div>

                    <!-- Comparison Chart -->
                    <div>
                        <h3 class="text-lg font-bold text-slate-800 border-b pb-2 mb-4">Algorithm Complexity (Measured)</h3>
                        <div class="chart-container">
                            <canvas id="complexityChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="overflow-x-auto">
                    <table class="min-w-full text-sm text-left text-slate-600">
                        <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                            <tr>
                                <th class="px-6 py-3">Dataset Type</th>
                                <th class="px-6 py-3">Size (n)</th>
                                <th class="px-6 py-3">Disorder Ratio</th>
                                <th class="px-6 py-3">Best Algorithm</th>
                                <th class="px-6 py-3">Execution (ms)</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white border-b">
                            <tr class="border-b hover:bg-slate-50">
                                <td class="px-6 py-4">Nearly Sorted</td>
                                <td class="px-6 py-4">100,000</td>
                                <td class="px-6 py-4 text-green-600 font-bold">2.1%</td>
                                <td class="px-6 py-4">InsertionSort</td>
                                <td class="px-6 py-4">45ms</td>
                            </tr>
                            <tr class="border-b hover:bg-slate-50">
                                <td class="px-6 py-4">Partially Sorted</td>
                                <td class="px-6 py-4">100,000</td>
                                <td class="px-6 py-4 text-amber-600 font-bold">15.5%</td>
                                <td class="px-6 py-4">MergeSort</td>
                                <td class="px-6 py-4">120ms</td>
                            </tr>
                            <tr class="border-b hover:bg-slate-50">
                                <td class="px-6 py-4">Random</td>
                                <td class="px-6 py-4">100,000</td>
                                <td class="px-6 py-4 text-rose-600 font-bold">48.2%</td>
                                <td class="px-6 py-4">QuickSort</td>
                                <td class="px-6 py-4">98ms</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-slate-900 text-slate-400 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center text-sm">
            <p>CS Undergraduate Algorithms ‚Ä¢ Module 02 Project ‚Ä¢ Traffic Sorter & Priority Queue</p>
            <p class="mt-2 text-xs">Remember to run simulations in a controlled environment.</p>
        </div>
    </footer>

    <!-- JS Logic -->
    <script>
        // --- Navigation Logic ---
        function navigate(sectionId) {
            document.querySelectorAll('.section-content').forEach(el => {
                el.classList.add('hidden');
                el.classList.remove('animate-fade-in');
            });
            const activeSection = document.getElementById(sectionId);
            activeSection.classList.remove('hidden');
            activeSection.classList.add('animate-fade-in');
            
            // Close mobile menu if open
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        // --- Exercise A: Adaptive Sorter Logic ---
        const datasetSizeInput = document.getElementById('datasetSize');
        const disorderRatioInput = document.getElementById('disorderRatio');
        const sizeValueDisp = document.getElementById('sizeValue');
        const disorderValueDisp = document.getElementById('disorderValue');
        const stateBadge = document.getElementById('stateBadge');
        const codeDisorder = document.getElementById('code-disorder-val');
        const codeLogic = document.getElementById('code-logic');

        const cardInsertion = document.getElementById('card-insertion');
        const cardMerge = document.getElementById('card-merge');
        const cardQuick = document.getElementById('card-quick');

        let algoChart;

        function updateSorterState() {
            const size = parseInt(datasetSizeInput.value);
            const disorder = parseInt(disorderRatioInput.value);

            // Update Text Displays
            sizeValueDisp.textContent = size.toLocaleString();
            disorderValueDisp.textContent = disorder + "%";
            codeDisorder.textContent = `// ${disorder}%`;

            // Reset Cards
            [cardInsertion, cardMerge, cardQuick].forEach(c => {
                c.classList.remove('border-indigo-500', 'bg-indigo-50', 'opacity-100', 'transform', 'scale-105', 'shadow-md');
                c.classList.add('opacity-50', 'border-slate-200');
            });

            // Logic Decision
            let activeCard;
            if (disorder < 5) {
                activeCard = cardInsertion;
                stateBadge.textContent = "Nearly Sorted";
                stateBadge.className = "inline-block px-3 py-1 rounded-full text-sm font-bold bg-green-100 text-green-800";
                codeLogic.innerHTML = `if (disorder < 5%) return <span class="text-indigo-400 font-bold">insertionSort(logs)</span>;`;
            } else if (disorder < 40) {
                activeCard = cardMerge;
                stateBadge.textContent = "Moderately Disordered";
                stateBadge.className = "inline-block px-3 py-1 rounded-full text-sm font-bold bg-amber-100 text-amber-800";
                codeLogic.innerHTML = `else if (disorder < 40%) return <span class="text-indigo-400 font-bold">mergeSort(logs)</span>;`;
            } else {
                activeCard = cardQuick;
                stateBadge.textContent = "Highly Disordered";
                stateBadge.className = "inline-block px-3 py-1 rounded-full text-sm font-bold bg-rose-100 text-rose-800";
                codeLogic.innerHTML = `else return <span class="text-indigo-400 font-bold">quickSort(logs)</span>;`;
            }

            // Highlight Active
            activeCard.classList.remove('opacity-50', 'border-slate-200');
            activeCard.classList.add('border-indigo-500', 'bg-indigo-50', 'opacity-100', 'transform', 'scale-105', 'shadow-md');

            // Update Chart
            updateAlgoChart(size, disorder);
        }

        // Initialize Charts
        document.addEventListener('DOMContentLoaded', () => {
            initAlgoChart();
            initComplexityChart();
            updateSorterState(); // Initial run
        });

        datasetSizeInput.addEventListener('input', updateSorterState);
        disorderRatioInput.addEventListener('input', updateSorterState);

        function initAlgoChart() {
            const ctx = document.getElementById('algoChart').getContext('2d');
            algoChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['InsertionSort', 'MergeSort', 'QuickSort'],
                    datasets: [{
                        label: 'Estimated Ops',
                        data: [0, 0, 0],
                        backgroundColor: ['#6366f1', '#94a3b8', '#94a3b8'],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: 'Operations (Approx)' } }
                    }
                }
            });
        }

        function updateAlgoChart(n, disorder) {
            // Simple heuristics for visual representation
            // Insertion: N if sorted, N^2 if random
            // Merge: N log N always
            // Quick: N log N avg, N^2 worst (but we assume avg for random)

            const disorderFactor = disorder / 100;
            
            // Heuristic Math
            const mergeOps = n * Math.log2(n);
            const quickOps = n * Math.log2(n) * 1.1; // Slightly higher constant usually, but faster in practice. Here strictly ops.
            
            // Insertion moves from N (at 0%) to N^2 (at 100%)
            // We scale it drastically for the chart to not be broken
            const insertionBase = n; 
            const insertionWorst = n * n / 1000; // Scaled down for visual comparison on same chart
            const insertionOps = insertionBase + (insertionWorst - insertionBase) * disorderFactor;

            algoChart.data.datasets[0].data = [insertionOps, mergeOps, quickOps];
            
            // Color Logic
            const colors = ['#94a3b8', '#94a3b8', '#94a3b8'];
            if (disorder < 5) colors[0] = '#6366f1';
            else if (disorder < 40) colors[1] = '#f59e0b';
            else colors[2] = '#e11d48';
            
            algoChart.data.datasets[0].backgroundColor = colors;
            algoChart.update();
        }


        // --- Exercise B: Priority Queue Logic ---
        let alertQueue = [];
        let globalTime = 0;
        let alertIdCounter = 1001;
        const AGE_PENALTY_FACTOR = 0.5; // Every minute reduces priority score by 0.5

        function renderQueue() {
            const listEl = document.getElementById('alertList');
            listEl.innerHTML = '';

            if (alertQueue.length === 0) {
                listEl.innerHTML = '<div class="text-center text-slate-400 mt-20 italic">Queue is empty. Systems nominal.</div>';
                return;
            }

            // Sort by effective priority (Ascending: Lower number = Higher Urgency)
            // Tie-breaker: Timestamp (FIFO)
            const sortedQueue = [...alertQueue].sort((a, b) => {
                if (Math.abs(a.effectivePriority - b.effectivePriority) > 0.1) {
                    return a.effectivePriority - b.effectivePriority;
                }
                return a.timestamp - b.timestamp;
            });

            sortedQueue.forEach(alert => {
                const el = document.createElement('div');
                // Styling based on urgency
                let borderClass = 'border-l-4 border-slate-300';
                if(alert.effectivePriority < 0) borderClass = 'border-l-4 border-rose-600 bg-rose-50'; // Escalated
                else if(alert.baseSeverity <= 2) borderClass = 'border-l-4 border-orange-500';
                
                el.className = `grid grid-cols-12 items-center bg-white p-3 rounded shadow-sm hover:bg-slate-50 transition ${borderClass}`;
                el.innerHTML = `
                    <div class="col-span-2 font-mono text-xs text-slate-500">#${alert.id}</div>
                    <div class="col-span-2 font-bold text-slate-700">${alert.baseSeverity}</div>
                    <div class="col-span-2 font-bold text-indigo-600">${alert.effectivePriority.toFixed(1)}</div>
                    <div class="col-span-2 text-xs text-slate-500">${alert.age}m</div>
                    <div class="col-span-4 text-sm truncate" title="${alert.desc}">${alert.desc}</div>
                `;
                listEl.appendChild(el);
            });
        }

        function addAlert() {
            const sev = parseInt(document.getElementById('alertSeverity').value);
            const desc = document.getElementById('alertDesc').value;
            
            const newAlert = {
                id: alertIdCounter++,
                baseSeverity: sev,
                effectivePriority: sev, // Initially same as base
                timestamp: Date.now(),
                age: 0,
                desc: desc
            };
            
            alertQueue.push(newAlert);
            renderQueue();
            
            // Randomize next input for UX
            const msgs = ["Login Failed", "CPU High", "Disk Full", "Intrusion Detect", "Ping Fail"];
            document.getElementById('alertDesc').value = msgs[Math.floor(Math.random() * msgs.length)];
        }

        function advanceTime() {
            globalTime += 15;
            
            // Format Clock
            const hrs = Math.floor(globalTime / 60).toString().padStart(2, '0');
            const mins = (globalTime % 60).toString().padStart(2, '0');
            document.getElementById('simClock').textContent = `${hrs}:${mins}`;

            // Update Alerts
            alertQueue.forEach(a => {
                a.age += 15;
                // Formula: Eff = Base - (Age * Penalty)
                a.effectivePriority = a.baseSeverity - (a.age * AGE_PENALTY_FACTOR);
            });
            renderQueue();
        }

        function processAlert() {
            if(alertQueue.length === 0) return;
            
            // Find min effective priority
            let minIndex = 0;
            let minVal = alertQueue[0].effectivePriority;
            
            for(let i=1; i<alertQueue.length; i++){
                if(alertQueue[i].effectivePriority < minVal){
                    minVal = alertQueue[i].effectivePriority;
                    minIndex = i;
                }
            }
            
            // Remove
            const processed = alertQueue.splice(minIndex, 1)[0];
            renderQueue();
            
            // Show toast or log (simplified here)
            // console.log("Processed:", processed);
        }

        // --- Exercise C: Complexity Chart ---
        function initComplexityChart() {
            const ctx = document.getElementById('complexityChart').getContext('2d');
            const nValues = [1000, 5000, 10000, 50000, 100000];
            
            // O(N) data
            const linear = nValues.map(n => n / 1000); // Scale factor for visual
            // O(N log N) data
            const nlogn = nValues.map(n => (n * Math.log2(n)) / 10000); 
            // O(N^2) data - only showing start of curve to keep chart readable
            const quadratic = nValues.map(n => (n * n) / 10000000); 

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: nValues,
                    datasets: [
                        {
                            label: 'O(N) - Insertion (Best)',
                            data: linear,
                            borderColor: '#10b981', // green
                            tension: 0.4
                        },
                        {
                            label: 'O(N log N) - Merge/Quick',
                            data: nlogn,
                            borderColor: '#3b82f6', // blue
                            tension: 0.4
                        },
                        {
                            label: 'O(N¬≤) - Insertion (Worst)',
                            data: quadratic,
                            borderColor: '#f43f5e', // rose
                            borderDash: [5, 5],
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { title: { display: true, text: 'Time / Operations (Scaled)' } },
                        x: { title: { display: true, text: 'Input Size (N)' } }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });
        }
    </script>

    <style>
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</body>
</html>



